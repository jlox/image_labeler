(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7959:(e,t,a)=>{Promise.resolve().then(a.bind(a,1191))},1191:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var l=a(5155),s=a(2115),n=a(2110);let o=[{id:"tmp",title:"Mountain Landscape",src:null}],r=e=>{let[t,a]=(0,s.useState)(o[0].id),[r,i]=(0,s.useState)({}),[c,d]=(0,s.useState)(!1),[h,u]=(0,s.useState)({x:0,y:0,width:0,height:0}),[x,m]=(0,s.useState)(null),g=(0,s.useRef)(null),[p,b]=(0,s.useState)("");(0,s.useEffect)(()=>{f()},[]),(0,s.useEffect)(()=>{j(e.user,t)},[t,e.user]);let f=async()=>{try{let e=await fetch("http://localhost:8000/whiteboards"),t=await e.json();o=t.whiteboards.map(e=>({id:e.image_id,title:e.image_id,src:e.image_url})),a(t.whiteboards[0].image_id)}catch(e){console.error("Error fetching whiteboards:",e)}},j=async(e,t)=>{try{let a=await fetch("http://localhost:8000/user/".concat(e,"/image/").concat(t,"/selections")),l=await a.json();i(e=>({...e,...l.selections}))}catch(e){console.error("Error fetching selections:",e)}},v=async(e,t)=>{try{let a=o.find(t=>t.id===e)||o[0];console.log("selectedImage: ",a),await fetch("http://localhost:8000/save-selections/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_id:e,image_name:a.title,selections:t[e]})}),(0,n.oR)("Saved!")}catch(e){console.error("Error saving selections:",e)}},w=e=>{let a=(r[t]||[]).filter((t,a)=>a!==e);i(e=>({...e,[t]:a})),v(t,{...r,[t]:a})},y=()=>{if(c&&(d(!1),h.width&&h.height)){let a={x:h.width>0?h.x:h.x+h.width,y:h.height>0?h.y:h.y+h.height,width:Math.abs(h.width),height:Math.abs(h.height),transcription:"",confidence:"",user:e.user||"",image_name:(o.find(e=>e.id===t)||o[0]).title||"",image_url:(o.find(e=>e.id===t)||o[0]).src||"",timestamp:new Date},l=[...r[t]||[],a];i({...r,[t]:l})}},N=e=>{let t=g&&g.current?g.current.getBoundingClientRect():{left:0,top:0};return{x:e.clientX-t.left,y:e.clientY-t.top}},C=(e,a,l)=>{let s=[...r[t]||[]];s[e]={...s[e],[a]:l},i(e=>({...e,[t]:s})),m(null)},S=e=>{a(e),m(null)},k=r[t]||[],M=o.find(e=>e.id===t)||o[0];return(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Image Selection Tool"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Choose an image and click and drag to select areas"})]}),(0,l.jsx)("div",{className:"mb-6 flex gap-4 overflow-x-auto pb-2",children:o.map(e=>(0,l.jsxs)("button",{onClick:()=>S(e.id),className:"flex flex-col items-center p-2 rounded-lg transition-colors ".concat(t===e.id?"bg-blue-100 border-2 border-blue-500":"bg-gray-100 hover:bg-gray-200"),children:[(0,l.jsx)("img",{src:e.src||"",alt:e.title,className:"w-24 h-16 object-cover rounded"}),(0,l.jsx)("span",{className:"mt-1 text-sm font-medium",children:e.title})]},e.id))}),(0,l.jsxs)("div",{ref:g,className:"relative w-full h-96 border-2 border-gray-300 rounded-lg overflow-hidden",onMouseDown:e=>{let{x:t,y:a}=N(e);d(!0),u({x:t,y:a,width:0,height:0})},onMouseMove:e=>{if(!c)return;let{x:t,y:a}=N(e);u(e=>({...e,width:t-e.x,height:a-e.y}))},onMouseUp:y,onMouseLeave:y,onDragStart:e=>{e.preventDefault()},children:[(0,l.jsx)("img",{src:M.src||"",alt:M.title,className:"w-full h-full object-contain"}),k.map((t,a)=>t.user===e.user?(0,l.jsx)("div",{className:"absolute border-2 border-blue-500 bg-blue-200 bg-opacity-30",style:{left:"".concat(t.x,"px"),top:"".concat(t.y,"px"),width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}},a):(0,l.jsx)("div",{})),c&&(0,l.jsx)("div",{className:"absolute border-2 border-red-500 bg-red-200 bg-opacity-30",style:{left:"".concat(h.x,"px"),top:"".concat(h.y,"px"),width:"".concat(h.width,"px"),height:"".concat(h.height,"px")}})]}),(0,l.jsxs)("div",{className:"mt-6 bg-gray-50 p-4 rounded-lg",children:[(0,l.jsxs)("h3",{className:"font-bold mb-2",children:["Selected Areas in ",M.title,":"]}),0===k.length?(0,l.jsx)("p",{className:"text-gray-500",children:"No areas selected yet"}):(0,l.jsx)("ul",{className:"space-y-4",children:k.map((t,a)=>t.user===e.user?(0,l.jsxs)("li",{className:"bg-white p-4 rounded-lg shadow-sm relative",children:[(0,l.jsx)("button",{onClick:()=>w(a),className:"absolute top-2 right-2 p-1 text-red-500 hover:bg-red-50 rounded",title:"Delete selection",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["Area ",a+1,": (",Math.round(t.x),", ",Math.round(t.y),") -",Math.round(t.width),"x",Math.round(t.height)]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Transcription:"}),(0,l.jsx)("input",{type:"text",value:t.transcription||"",onChange:e=>C(a,"transcription",e.target.value),autoFocus:!0,className:"mt-1 w-full p-2 border rounded",placeholder:"Enter transcription..."})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Confidence:"}),(0,l.jsx)("input",{type:"text",value:t.confidence||"",onChange:e=>C(a,"confidence",e.target.value),onBlur:()=>m(null),autoFocus:!0,className:"mt-1 w-full p-2 border rounded",placeholder:"Enter confidence level..."})]})]}),(0,l.jsx)("button",{onClick:()=>v(M.title,r),className:"top-4 right-2 p-1 rounded",title:"Delete selection",children:"Save"}),(0,l.jsx)(n.N9,{})]},a):(0,l.jsx)("div",{}))})]})]})},i=()=>{let e=async()=>{try{let e=await fetch("http://localhost:8000/export"),{data:t}=await e.json();if(!(null==t?void 0:t.length))return;let a=[...new Set(t.flatMap(e=>Object.keys(e)))].sort(),l=[a.join(","),...t.map(e=>a.map(t=>{var a;let l=null!==(a=e[t])&&void 0!==a?a:"";return'"'.concat(String(l).replace(/"/g,'""'),'"')}).join(","))],s=new Blob([l.join("\n")],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download="data.csv",document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){console.error("Download failed:",e)}};return(0,l.jsx)("button",{onClick:e,style:{padding:"8px 16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Download CSV"})};function c(){let[e,t]=(0,s.useState)(""),[a,n]=(0,s.useState)(""),o=()=>{t(a)},c=e=>{n(e.target.value)};return(0,l.jsx)("main",{className:"min-h-screen bg-gray-100 py-8",children:""===e?(0,l.jsxs)("div",{className:"container mx-auto px-4",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-center mb-8",children:"Identify yourself."}),(0,l.jsxs)("label",{children:["Name: ",(0,l.jsx)("input",{onChange:e=>c(e),name:"user"})]}),(0,l.jsx)("button",{onClick:()=>o(),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Log in"})]}):(0,l.jsxs)("div",{className:"container mx-auto px-4",children:[(0,l.jsx)(i,{}),(0,l.jsx)("h1",{className:"text-3xl font-bold text-center mb-8",children:"Image Selection Tool"}),(0,l.jsx)(r,{user:e})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[110,441,517,358],()=>t(7959)),_N_E=e.O()}]);